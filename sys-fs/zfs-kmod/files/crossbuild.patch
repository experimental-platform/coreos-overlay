commit 76d5bf196cf6e5625f884a9ebbdaf53873a5a979
Author: Kamil Domański <kamil@domanski.co>
Date:   Wed Dec 16 17:24:28 2015 +0100

    Skip GPL-only symbols test when cross-compiling
    
    Signed-off-by: Kamil Domański <kamil@domanski.co>
    Signed-off-by: Brian Behlendorf <behlendorf1@llnl.gov>
    Closes #4107

diff --git a/config/kernel.m4 b/config/kernel.m4
index 906d39d..31ba79f 100644
--- a/config/kernel.m4
+++ b/config/kernel.m4
@@ -448,16 +448,18 @@ dnl # detected at configure time and cause a build failure.  Otherwise
 dnl # modules may be successfully built that behave incorrectly.
 dnl #
 AC_DEFUN([ZFS_AC_KERNEL_CONFIG], [
-	AC_RUN_IFELSE([
-		AC_LANG_PROGRAM([
-			#include "$LINUX/include/linux/license.h"
+	AS_IF([test "x$cross_compiling" != xyes], [
+		AC_RUN_IFELSE([
+			AC_LANG_PROGRAM([
+				#include "$LINUX/include/linux/license.h"
+			], [
+				return !license_is_gpl_compatible("$ZFS_META_LICENSE");
+			])
+		], [
+			AC_DEFINE([ZFS_IS_GPL_COMPATIBLE], [1],
+			    [Define to 1 if GPL-only symbols can be used])
 		], [
-			return !license_is_gpl_compatible("$ZFS_META_LICENSE");
 		])
-	], [
-		AC_DEFINE([ZFS_IS_GPL_COMPATIBLE], [1],
-		    [Define to 1 if GPL-only symbols can be used])
-	], [
 	])
 
 	ZFS_AC_KERNEL_CONFIG_THREAD_SIZE
